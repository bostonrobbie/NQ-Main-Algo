
// This Pine Script was AUTO-GENERATED by the StrategyPipeline
// Optimized Settings included.

//@version=5
strategy("NQ ORB 15m [Auto]", overlay=true, margin_long=100, margin_short=100)

// --- Inputs (Optimized) ---
sl_atr_mult = input.float(2.0, "SL ATR Mult")
tp_atr_mult = input.float(3.0, "TP ATR Mult")
ema_period = input.int(, "Regime EMA")
adx_thresh = input.float(20.0, "ADX Threshold")
orb_start_hour = 9
orb_start_minute = 30
orb_end_hour = 9
orb_end_minute = 45

// --- Logic ---
// 1. Session Logic
t = time(timeframe.period, "0930-1600")
is_session = not na(t)

// 2. ORB Range
var float orb_high = na
var float orb_low = na

if (hour == orb_start_hour and minute == orb_start_minute)
    orb_high := high
    orb_low := low
else if (hour == orb_start_hour and minute >= orb_start_minute and minute < orb_end_minute)
    orb_high := math.max(orb_high, high)
    orb_low := math.min(orb_low, low)

// Reset daily
if ta.change(time("D"))
    orb_high := na
    orb_low := na

plot(orb_high, "ORB High", color=color.green, style=plot.style_stepline)
plot(orb_low, "ORB Low", color=color.red, style=plot.style_stepline)

// 3. Indicators
ema_val = ta.ema(close, ema_period)
atr_val = ta.atr(14)
plot(ema_val, "EMA", color=color.yellow)

// 4. Entry
long_cond = close > orb_high and close > ema_val and strategy.position_size == 0 and is_session
short_cond = close < orb_low and close < ema_val and strategy.position_size == 0 and is_session

if (long_cond)
    strategy.entry("Long", strategy.long)
    strategy.exit("Exit Long", "Long", stop=close - (atr_val * sl_atr_mult), limit=close + (atr_val * tp_atr_mult))

if (short_cond)
    strategy.entry("Short", strategy.short)
    strategy.exit("Exit Short", "Short", stop=close + (atr_val * sl_atr_mult), limit=close - (atr_val * tp_atr_mult))

// 5. EOD Flatten
if (hour == 15 and minute == 45)
    strategy.close_all("EOD")